<?php

require_once WC_LOAD_TEST_DIR . '/includes/abstract-load-test.php';

class AddToCartLoadTest extends LoadTest {

	public static function get_tests() {
		return array(
			'add_to_cart' => array(
				'label' => 'Add Simple Product to cart.',
				'callback' => 'add_simple_product_to_cart'
			),
		);
	}

	public static function setup() {
		$product = new \WC_Product();
		$product->set_props(
			array(
				'name'           => 'Generated by Load testing ',
				'regular_price'  => 1,
				'sales_price'    => 2,
				'tax_status'     => 'taxable',
				'manage_stock'   => true,
				'stock_quantity' => 1000,
				'stock_status'   => 'instock',
			)
		);
		$product->save();
		return array(
			'product_id' => $product->get_id(),
			'quantity' => 1,
		);
	}

	public static function add_simple_product_to_cart( $args ) {
		$_REQUEST['add-to-cart'] = $args['product_id'];
		$_REQUEST['quantity'] = 1;
		WC_Form_Handler::add_to_cart_action();
	}

	public static function teardown( $product_id ) {
		$product = \WC_Product( $product_id );
		$product->delete( true );
	}
}
